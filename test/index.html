<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wildstyle Radio ‚Äî Live Dashboard</title>

  <!-- Basic bootstrap for layout -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root{
      --bg:#07070a;
      --panel:#0f1114;
      --muted:#aab3c5;
      --accent1:#ff0032;
      --accent2:#0096ff;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --card-pad:14px;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#040406);font-family:Inter, system-ui, -apple-system, Arial, sans-serif;color:#fff}
    .wrap{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;gap:18px;align-items:center;justify-content:space-between;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));box-shadow:0 8px 30px rgba(0,0,0,0.7)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:64px;height:64px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900}
    .brand h1{margin:0;font-size:1.1rem;letter-spacing:1px}
    .controls{display:flex;gap:8px;align-items:center}

    /* Buttons */
    .btn-ws{border-radius:999px;padding:8px 14px;font-weight:700;border:none;cursor:pointer}
    .btn-play{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;box-shadow:0 8px 26px rgba(0,0,0,0.6)}
    .btn-mail{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}

    /* Now playing small section */
    .nowline{display:flex;gap:12px;align-items:center;font-size:0.95rem;color:var(--muted)}
    .nowline strong{color:#fff}

    /* Layout grid */
    .grid{display:grid;grid-template-columns: 1fr 360px;gap:18px;margin-top:18px}
    main{min-height:360px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));}
    aside{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.012));border-left:1px solid rgba(255,255,255,0.02)}

    /* Now Playing card (big) */
    .now-card{background:var(--panel);padding:16px;border-radius:10px;margin-bottom:14px}
    .now-card h3{margin:0;color:var(--accent1)}
    .now-meta{color:var(--muted);margin-top:8px}

    /* Who's Listening (wildstyle theme) */
    .listeners{background:#0a0a0f;padding:14px;border-radius:12px;box-shadow:0 0 20px rgba(255,0,50,0.12),0 0 30px rgba(0,150,255,0.08)}
    .listeners-title{display:flex;align-items:center;justify-content:center;gap:12px;font-weight:700;color:#fff;text-shadow:0 0 8px rgba(255,0,50,0.06)}
    .listener-count{display:inline-block;margin-left:8px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));font-family:monospace;box-shadow:0 0 10px rgba(255,0,50,0.45);transition:transform .18s,box-shadow .18s}
    .pulse{animation:ws-pulse 1s ease-in-out 2}
    @keyframes ws-pulse{0%{transform:scale(1);box-shadow:0 0 8px rgba(255,0,50,0.45)}50%{transform:scale(1.12);box-shadow:0 0 20px rgba(255,0,50,0.7)}100%{transform:scale(1);box-shadow:0 0 10px rgba(255,0,50,0.45)}}

    .listener-box{background:#111;padding:10px;border-radius:8px;color:#ddd;font-family:monospace;max-height:320px;overflow:auto;border:1px solid rgba(255,255,255,0.04)}
    .listener-item{background:#151515;margin:8px 0;padding:10px;border-radius:8px;border-left:3px solid var(--accent1);display:flex;gap:10px;align-items:center;justify-content:space-between}
    .listener-info{font-size:0.9rem;color:#fff}
    .listener-meta{font-size:0.82rem;color:var(--muted)}

    /* Schedule */
    .schedule-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
    .sched-card{background:linear-gradient(180deg,#0f1114,#0b0c10);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .sched-card h4{color:var(--accent2);margin-bottom:8px}

    /* footer */
    footer{margin-top:18px;padding:10px;color:var(--muted);text-align:center;font-size:0.9rem}

    /* Responsiveness */
    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      aside{order:2}
    }
  </style>
</head>
<body>

<div class="wrap">
  <!-- header -->
  <header>
    <div class="brand">
      <div class="logo">WS</div>
      <div>
        <h1>Wildstyle Radio</h1>
        <div style="font-size:0.82rem;color:var(--muted)">United by Beats ‚Ä¢ Powered by Passion</div>
      </div>
    </div>

    <div class="controls">
      <div class="nowline">
        <strong>Now Playing:</strong> <span id="NowOn" style="margin-left:8px">Loading‚Ä¶</span>
      </div>

      <button class="btn-ws btn-play" id="playBtn" onclick="togglePlayer()" style="margin-left:12px">‚ñ∂ Live Player</button>
      <audio id="livePlayer" src="https://streaming.live365.com/a50378"></audio>

      <a class="btn-ws btn-mail" href="mailto:requests@wildstyle.vip" style="margin-left:10px">Request A Song</a>
    </div>
  </header>

  <div class="grid">
    <!-- main column -->
    <main>
      <!-- Now card (bigger) -->
      <div class="now-card">
        <h3>Now On Wildstyle</h3>
        <div class="now-meta" id="nowMeta">Loading current show‚Ä¶</div>
      </div>

      <!-- schedule -->
      <div class="schedule-grid">
        <!-- Monday example; more days follow -->
        <div class="sched-card" id="mon-card">
          <h4>Monday</h4>
          <div id="mon-now" style="margin-bottom:8px"></div>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>12am ‚Äì 2am:</strong> DJ Riddler - Riddlers Killer Rockshow</li>
            <li><strong>4am:</strong> </li>
            <li><strong>12pm ‚Äì 2pm:</strong> James - Wizard Of Rock</li>
            <li><strong>2pm - 4pm:</strong> BabyJane</li>
            <li><strong>3pm - 5pm:</strong> James Stephen</li>
            <li><strong>5pm ‚Äì 7pm:</strong> Lewis - Mix</li>
            <li><strong>7pm ‚Äì 9pm:</strong> DJ Josh</li>
            <li><strong>7pm ‚Äì 10pm:</strong> DJ Dezzy Mac - Mixture (takin break)</li>
            <li><strong>10pm ‚Äì 12am:</strong> DJ Jaydon Mac - Grime</li>
          </ul>
        </div>

        <!-- add other days cards as needed (Tue-Sun). Keep IDs so Now-On shows update per day if desired -->
        <div class="sched-card">
          <h4>Tuesday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>1am ‚Äì 2am:</strong> Wizard Of Rock</li>
            <li><strong>3am ‚Äì 6am:</strong> Dani - DJ Queen Dani</li>
            <li><strong>6am ‚Äì 8am:</strong> Dj Dave ‚Äì 60's - 70's</li>
            <li><strong>3pm ‚Äì 5pm:</strong> James Stephen</li>
            <li><strong>8pm ‚Äì 10pm:</strong> Dj Lewis</li>
            <li><strong>10am ‚Äì 12pm:</strong> HothotDJ</li>
          </ul>
        </div>

        <div class="sched-card">
          <h4>Wednesday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>3pm ‚Äì 5pm:</strong> James Stephen</li>
            <li><strong>6pm ‚Äì 7pm:</strong> DJ European BOB</li>
            <li><strong>8pm ‚Äì 10pm:</strong> Steve DJ Smith</li>
            <li><strong>10pm ‚Äì 12pm:</strong> Reece</li>
          </ul>
        </div>

        <div class="sched-card">
          <h4>Thursday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>4am ‚Äì 6am:</strong> Dani - DJ Queen Dani</li>
            <li><strong>8am ‚Äì 10am:</strong> Coll</li>
            <li><strong>12am ‚Äì 4am:</strong> Steve Gunn</li>
            <li><strong>10am ‚Äì 12pm:</strong> Gordan</li>
            <li><strong>3pm ‚Äì 4pm:</strong> James Stephen</li>
            <li><strong>5pm ‚Äì 7pm:</strong> DJ Flash</li>
            <li><strong>7pm ‚Äì 8pm:</strong> Echofalls (DJ Strawbs)</li>
            <li><strong>8pm ‚Äì 10pm:</strong> Moofie</li>
            <li><strong>10pm ‚Äì 11pm:</strong> MottMuzik</li>
          </ul>
        </div>

        <div class="sched-card">
          <h4>Friday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>4am ‚Äì 6am:</strong> Dani - DJ Queen Dani</li>
            <li><strong>12am ‚Äì 4am:</strong> SteveG</li>
            <li><strong>10am ‚Äì 12pm:</strong> Vish</li>
            <li><strong>3pm ‚Äì 5pm:</strong> James Stephen</li>
            <li><strong>4pm ‚Äì 8pm:</strong> StevenD</li>
            <li><strong>8pm ‚Äì 10pm:</strong> Wendall</li>
            <li><strong>10pm ‚Äì 11pm:</strong> Rebecca - DJ Mix&Match</li>
          </ul>
        </div>

        <div class="sched-card">
          <h4>Saturday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>12am ‚Äì 2am:</strong> Trevor Nannab</li>
            <li><strong>2am ‚Äì 4am:</strong> DJ AJ</li>
            <li><strong>6am ‚Äì 10am:</strong> Cam</li>
            <li><strong>10am ‚Äì 12am:</strong> Kevin Lee</li>
            <li><strong>4pm ‚Äì 6pm:</strong> The Byrdman</li>
            <li><strong>8pm ‚Äì 9pm:</strong> Daniel</li>
          </ul>
        </div>

        <div class="sched-card">
          <h4>Sunday</h4>
          <ul style="padding-left:0;list-style:none;margin:0;font-size:0.95rem;color:var(--muted)">
            <li><strong>8am ‚Äì 10am:</strong> The Byrdman</li>
            <li><strong>10am ‚Äì 12pm:</strong> HotShot - 80's 90's</li>
            <li><strong>11am ‚Äì 1pm:</strong> JimmyD</li>
            <li><strong>1pm ‚Äì 3pm:</strong> JK</li>
            <li><strong>5pm ‚Äì 7pm:</strong> DJ Lewis</li>
            <li><strong>7pm ‚Äì 8pm:</strong> DJ European Bob</li>
            <li><strong>8pm ‚Äì 9pm:</strong> BIG BOSS Dj Echofalls</li>
            <li><strong>9pm ‚Äì 12am:</strong> Popped Radio</li>
          </ul>
        </div>

      </div>
    </main>

    <!-- sidebar -->
    <aside>
      <!-- Live Player info and listeners -->
      <div style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:700">Live Player</div>
          <div id="liveListenersBadge" style="color:var(--muted);font-size:0.9rem">Listeners</div>
        </div>
        <div style="margin-bottom:8px">
          <!-- small player placeholder -->
          <audio id="sidePlayer" controls style="width:100%">
            <source src="https://streaming.live365.com/a50378" type="audio/mpeg">
            Your browser doesn't support audio.
          </audio>
        </div>
      </div>

      <!-- WHO'S LISTENING panel -->
      <div class="listeners">
        <div class="listeners-title">
          Who's Listening <span id="listenerCount" class="listener-count">üéß 0</span>
        </div>
        <div id="listenerList" class="listener-box">Loading live listeners...</div>
      </div>
    </aside>
  </div>

  <footer>
    Wildstyle Radio ‚Ä¢ Built for the movement
  </footer>
</div>

<script>
/* -----------------------
   Play / Pause main play button
   ----------------------- */
function togglePlayer(){
  const player = document.getElementById('livePlayer');
  const btn = document.getElementById('playBtn');
  if(player.paused){
    player.play().catch(()=>{}); // autoplay block may apply
    btn.textContent = '‚è∏ Pause Player';
  } else {
    player.pause();
    btn.textContent = '‚ñ∂ Live Player';
  }
}

/* -----------------------
   Now Playing schedule logic
   - A robust mapping: scheduleMap keyed by weekday names
   - Will show a sensible "Now On" string
   ----------------------- */
const scheduleMap = {
  Monday: {
    0: "", 1: "12am ‚Äì 2am: DJ Riddler - Riddlers Killer Rockshow",
    12: "12pm ‚Äì 2pm: James - Wizard Of Rock",
    14: "2pm ‚Äì 4pm: BabyJane",
    15: "3pm ‚Äì 5pm: James Stephen",
    17: "5pm ‚Äì 7pm: Lewis - Mix",
    19: "7pm ‚Äì 10pm: DJ Dezzy Mac - Mixture",
    22: "10pm ‚Äì 12am: DJ Jaydon Mac - Grime"
  },
  Tuesday: {
    1: "1am ‚Äì 2am: Wizard Of Rock",
    3: "3am ‚Äì 6am: Dani - DJ Queen Dani",
    6: "6am ‚Äì 8am: Dj Dave ‚Äì 60's - 70's",
    15: "3pm ‚Äì 5pm: James Stephen",
    20: "8pm ‚Äì 10pm: Dj Lewis",
    10: "10am ‚Äì 12pm: HothotDJ"
  },
  Wednesday: {
    15: "3pm ‚Äì 5pm: James Stephen",
    18: "6pm ‚Äì 7pm: DJ European BOB",
    20: "8pm ‚Äì 10pm: Steve DJ Smith",
    22: "10pm ‚Äì 12pm: Reece"
  },
  Thursday: {
    4: "4am ‚Äì 6am: Dani - DJ Queen Dani",
    8: "8am ‚Äì 10am: Coll",
    0: "12am ‚Äì 4am: Steve Gunn",
    10: "10am ‚Äì 12pm: Gordan",
    15: "3pm ‚Äì 4pm: James Stephen",
    17: "5pm ‚Äì 7pm: DJ Flash",
    19: "7pm ‚Äì 8pm: Echofalls (DJ Strawbs)",
    20: "8pm ‚Äì 10pm: Moofie",
    22: "10pm ‚Äì 11pm: MottMuzik"
  },
  Friday: {
    4: "4am ‚Äì 6am: Dani - DJ Queen Dani",
    0: "12am ‚Äì 4am: SteveG",
    10: "10am ‚Äì 12pm: Vish",
    15: "3pm ‚Äì 5pm: James Stephen",
    16: "4pm ‚Äì 8pm: StevenD",
    20: "8pm ‚Äì 10pm: Wendall",
    22: "10pm ‚Äì 11pm: Rebecca - DJ Mix&Match"
  },
  Saturday: {
    0: "12am ‚Äì 2am: Trevor Nannab",
    2: "2am ‚Äì 4am: DJ AJ",
    6: "6am ‚Äì 10am: Cam",
    10: "10am ‚Äì 12am: Kevin Lee",
    16: "4pm ‚Äì 6pm: The Byrdman",
    20: "8pm ‚Äì 9pm: Daniel"
  },
  Sunday: {
    8: "8am ‚Äì 10am: The Byrdman",
    10: "10am ‚Äì 12pm: HotShot - 80's 90's",
    11: "11am ‚Äì 1pm: JimmyD",
    13: "1pm ‚Äì 3pm: JK",
    17: "5pm ‚Äì 7pm: DJ Lewis",
    19: "7pm ‚Äì 8pm: DJ European Bob",
    20: "8pm ‚Äì 9pm: BIG BOSS Dj Echofalls",
    21: "9pm ‚Äì 12am: Popped Radio"
  }
};

function getNowShow(){
  const now = new Date();
  // map JS weekday (0 Sun..6 Sat) to name
  const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const dayName = dayNames[now.getDay()];
  const hour = now.getHours();
  const daySchedule = scheduleMap[dayName] || {};
  // find exact hour match, or find the latest entry before current hour
  if(daySchedule[hour]) return `${dayName} ${formatHour(hour)} ‚Äî ${daySchedule[hour]}`;
  // search backwards to find most recent scheduled time <= hour
  const keys = Object.keys(daySchedule).map(k=>parseInt(k)).sort((a,b)=>a-b);
  for(let i = keys.length-1; i>=0; i--){
    if(keys[i] <= hour && keys[i] !== 0){ // honor entry
      return `${dayName} ${formatHour(keys[i])} ‚Äî ${daySchedule[keys[i]]}`;
    }
    if(keys[i] === 0 && hour < 6){ // midnight-early morning slot
      return `${dayName} 00:00 ‚Äî ${daySchedule[0]}`;
    }
  }
  return `No Show Scheduled ‚Äî check the schedule`;
}
function formatHour(h){
  // simple label for display: return e.g. 22:00 or 00:00
  return (h<10?'0'+h:h)+':00';
}
function refreshNowOn(){
  const nowText = getNowShow();
  document.getElementById('NowOn').textContent = nowText;
  document.getElementById('nowMeta').innerHTML = nowText;
}
refreshNowOn();
setInterval(refreshNowOn, 60_000); // update every minute

/* -----------------------
   Live listeners from realtime.csv
   - expects realtime.csv in same folder
   - shows active_session_count > 0
   - pulses counter when new listeners join
   ----------------------- */
let lastCount = 0;
async function updateListeners(){
  try{
    const res = await fetch('realtime.csv?_=' + Date.now()); // cache buster
    const text = await res.text();
    // parse csv robustly enough for simple format (no embedded commas)
    const lines = text.trim().split(/\r?\n/).filter(Boolean);
    if(lines.length < 2){
      document.getElementById('listenerList').innerHTML = '<p style="color:var(--muted)">No data</p>';
      document.getElementById('listenerCount').textContent = 'üéß 0';
      return;
    }
    // headers
    const headers = lines[0].split(',').map(h=>h.trim());
    const rows = lines.slice(1).map(line=>{
      // naive split: good for your CSV structure
      const cells = line.split(',').map(c=>c.trim());
      const obj = {};
      headers.forEach((h,i)=>obj[h]=cells[i]||'');
      return obj;
    });

    const active = rows.filter(r => parseInt(r.active_session_count||0) > 0);
    const count = active.length;
    // set badge
    const badge = document.getElementById('listenerCount');
    badge.textContent = `üéß ${count}`;
    // pulse if count increased
    if(count > lastCount){
      badge.classList.add('pulse');
      setTimeout(()=>badge.classList.remove('pulse'), 1200);
    }
    lastCount = count;
    // also update small text in sidebar
    document.getElementById('liveListenersBadge').textContent = `${count} live`;

    if(count === 0){
      document.getElementById('listenerList').innerHTML = '<p style="color:var(--muted)">No active listeners right now üîá</p>';
      return;
    }

    // build items
    const items = active.map(r=>{
      const country = r.country || 'Unknown';
      const region = r.region || '';
      const city = r.city || '';
      const platform = r.platform || 'Unknown';
      const durationSec = parseInt(r.duration||0);
      const durationMin = Math.max(1, Math.round(durationSec/60));
      return {country,region,city,platform,durationMin};
    });

    // make HTML
    const html = items.map(it=>`
      <div class="listener-item">
        <div class="listener-info">üåç <strong>${it.country}</strong> ‚Äî ${it.region}${it.city?(', ' + it.city):''}</div>
        <div style="text-align:right">
          <div class="listener-meta">üíª ${it.platform}</div>
          <div class="listener-meta">‚è± ${it.durationMin} min</div>
        </div>
      </div>
    `).join('');
    document.getElementById('listenerList').innerHTML = html;

  }catch(err){
    console.error('listeners error', err);
    document.getElementById('listenerList').innerHTML = '<p style="color:var(--muted)">Error loading listeners</p>';
  }
}

// start updates every 20s
updateListeners();
setInterval(updateListeners, 20_000);

</script>

</body>
</html>
