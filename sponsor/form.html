<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sponsor a Track | Wildstyle Radio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/sponsor/style.css">
</head>
<body>

  <main class="sponsor-page">
    <section class="sponsor-form-section">
      <h1>Sponsor a Track</h1>
      <p>Fill out the form below and complete payment to have your track and message aired live.</p>

      <form id="sponsorForm">
        <div class="form-row">
          <label for="name">Your Name (for the DJ to credit)</label>
          <input type="text" id="name" name="name" required>
        </div>

        <div class="form-row">
          <label for="track">Track Name</label>
          <input type="text" id="track" name="track" required>
        </div>

        <div class="form-row">
          <label for="artist">Artist</label>
          <input type="text" id="artist" name="artist" required>
        </div>

        <div class="form-row">
          <label for="message">Personal Message</label>
          <textarea id="message" name="message" rows="4" placeholder="For my partner Sarah, with love on our anniversary." required></textarea>
        </div>

        <div class="form-row">
          <label for="dj">Preferred DJ / Show (optional)</label>
          <select id="dj" name="dj">
            <option value="">No preference</option>
            <option value="DJ EchoFalls">DJ EchoFalls</option>
            <option value="DJ Indigo Riz">DJ Indigo Riz</option>
            <option value="DJ Sonic Circuit">DJ Sonic Circuit</option>
			<option value="HotShotDJ">HotshotDJ</option>
			<option value="DJ Mix&Match">DJ Mix&Match</option>
			<option value="DJ Nitro">DJ Nitro</option>
			<option value="Coll">Coll</option>
            <!-- Add all your DJs here -->
          </select>
        </div>

        <div class="form-row">
          <label for="email">Your Email (for confirmation)</label>
          <input type="email" id="email" name="email" required>
        </div>

        <div class="form-row">
          <p class="price-tag">Total: <strong>Â£4.99</strong> per sponsored track</p>
        </div>

        <!-- Status message -->
        <div id="sponsorStatus" class="status-msg"></div>

        <!-- PayPal button container -->
        <div id="paypal-button-container"></div>
      </form>
    </section>
  </main>

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AaLTrDBFsPpBiuyksKpwy&currency=GBP"></script>

  <script>
    const statusBox = document.getElementById('sponsorStatus');
    const formEl = document.getElementById('sponsorForm');

    // Pre-select DJ if ?dj=DJ%20EchoFalls etc.
    (function preselectDJ() {
      const params = new URLSearchParams(window.location.search);
      const djParam = params.get('dj');
      if (djParam) {
        const djSelect = document.getElementById('dj');
        djSelect.value = djParam;
      }
    })();

    paypal.Buttons({
      createOrder: function(data, actions) {
        statusBox.textContent = "";
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: "4.99"
            },
            description: "Wildstyle Radio Track Sponsorship"
          }]
        });
      },

      onApprove: function(data, actions) {
        statusBox.textContent = "Processing payment...";
        return actions.order.capture().then(function(details) {
          statusBox.textContent = "Saving your dedication...";

          const formData = new FormData(formEl);
          const payload = Object.fromEntries(formData.entries());

          // Add payment info
          payload.paymentProvider = "PayPal";
          payload.orderId = details.id;
          payload.payerName = details.payer.name.given_name + " " + details.payer.name.surname;
          payload.amount = details.purchase_units[0].amount.value;
          payload.currency = details.purchase_units[0].amount.currency_code;

          fetch("https://script.google.com/macros/s/AKfycbyeSvf2Mxtekez1n-voPheLQpByUOZBO-uyrpFvWdUy6L0yswCXt7vnDy55ccRWBWdK/exec", {
            method: "POST",
            mode: "no-cors", // Apps Script often needs this
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
          })
          .then(() => {
            window.location.href = "/sponsor/thankyou.html";
          })
          .catch(err => {
            console.error(err);
            statusBox.textContent = "Payment completed but we had an issue saving your dedication. Please contact us with your PayPal receipt.";
          });
        });
      },

      onError: function(err) {
        console.error(err);
        statusBox.textContent = "There was a problem with the payment. Please try again.";
      }
    }).render('#paypal-button-container');
  </script>

</body>
</html>
